<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YILI & LIA | Moda para todos</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- FontAwesome Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            /* Variables Tema Claro */
            --primary-color: #1a1a1a;
            --accent-color: #C5A059;
            --heart-color: #ff4757;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --shadow: 0 4px 6px rgba(0,0,0,0.05);
            --hover-shadow: 0 8px 15px rgba(0,0,0,0.1);
            --header-height: 70px;
            --sidebar-width: 280px;
        }

        [data-theme="dark"] {
            /* Variables Tema Oscuro */
            --primary-color: #ffffff;
            --accent-color: #D4AF37;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #333333;
            --shadow: 0 4px 6px rgba(0,0,0,0.3);
            --hover-shadow: 0 8px 15px rgba(0,0,0,0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; transition: background-color 0.3s ease, color 0.3s ease; }
        body { background-color: var(--bg-color); color: var(--text-color); padding-top: var(--header-height); }

        /* --- Encabezado --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--header-height);
            background-color: var(--card-bg); border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: space-between; padding: 0 1rem; z-index: 1000; box-shadow: var(--shadow);
        }
        
        .header-left { display: flex; align-items: center; gap: 10px; }
        
        .logo-container { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .logo-img { height: 40px; width: auto; }

        /* Botón Menú Hamburguesa (Mobile) */
        .hamburger-btn {
            background: none; border: none; font-size: 1.2rem; color: var(--text-color);
            cursor: pointer; display: none; padding: 5px;
        }
        .hamburger-btn:hover { color: var(--accent-color); }

        .search-bar { flex: 1; max-width: 500px; margin: 0 2rem; position: relative; display: none; }
        @media(min-width: 768px) { .search-bar { display: block; } }
        .search-bar input {
            width: 100%; padding: 10px 15px 10px 40px; border-radius: 20px;
            border: 1px solid var(--border-color); background-color: var(--bg-color);
            color: var(--text-color); outline: none;
        }
        .search-bar i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); }
        .user-actions { display: flex; align-items: center; gap: 20px; }
        .icon-btn { background: none; border: none; cursor: pointer; font-size: 1.2rem; color: var(--text-color); position: relative; }
        .icon-btn:hover { color: var(--accent-color); }
        .badge {
            position: absolute; top: -8px; right: -8px; background-color: var(--accent-color); color: white;
            font-size: 0.7rem; width: 18px; height: 18px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }

        /* --- Layout Principal --- */
        .container { display: flex; min-height: calc(100vh - var(--header-height)); position: relative; }
        
        /* --- Sidebar / Filtros --- */
        aside {
            width: 250px;
            padding: 2rem;
            background-color: var(--card-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: calc(100vh - var(--header-height));
            overflow-y: auto;
            /* Posición por defecto (Desktop) */
            position: relative;
            z-index: 1100;
        }

        /* Comportamiento Móvil (Estilo Amazon) */
        @media(max-width: 899px) {
            aside {
                position: fixed;
                top: var(--header-height);
                left: calc(-1 * var(--sidebar-width)); /* Oculto a la izquierda */
                width: var(--sidebar-width);
                max-width: 85vw;
                height: 100vh;
                transition: left 0.3s ease-in-out;
                box-shadow: 5px 0 15px rgba(0,0,0,0.1);
                padding: 1.5rem;
            }

            /* Estado activo del menú móvil */
            aside.open {
                left: 0;
            }

            .hamburger-btn { display: block; } /* Mostrar hamburguesa */
        }

        .mobile-close-btn {
            display: none;
            align-self: flex-end;
            background: none; border: none; font-size: 1.5rem; color: var(--text-color); margin-bottom: 1rem;
        }
        @media(max-width: 899px) { .mobile-close-btn { display: block; } }

        /* Overlay para móvil */
        .mobile-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); z-index: 1050;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .mobile-overlay.active { display: block; opacity: 1; }

        /* Estilos del Filtro */
        .filter-section { margin-bottom: 2rem; }
        .filter-title { font-size: 1rem; font-weight: 700; margin-bottom: 1rem; text-transform: uppercase; color: var(--primary-color); }
        .filter-group { list-style: none; }
        .filter-item { padding: 8px 0; cursor: pointer; color: var(--text-secondary); display: flex; align-items: center; gap: 10px; }
        .filter-item:hover, .filter-item.active { color: var(--accent-color); font-weight: 600; }
        .filter-checkbox { accent-color: var(--accent-color); }

        /* --- Grid --- */
        main { flex: 1; padding: 1.5rem; background-color: var(--bg-color); width: 100%; }
        .product-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .product-count { color: var(--text-secondary); font-size: 0.9rem; }
        .sort-select {
            padding: 8px; border-radius: 5px; border: 1px solid var(--border-color);
            background-color: var(--card-bg); color: var(--text-color);
        }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1.5rem; }
        @media(min-width: 600px) { .grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); } }

        /* --- Tarjeta --- */
        .card {
            background-color: var(--card-bg); border-radius: 8px; overflow: hidden;
            box-shadow: var(--shadow); transition: transform 0.2s, box-shadow 0.2s; position: relative; cursor: pointer;
        }
        .card:hover { transform: translateY(-5px); box-shadow: var(--hover-shadow); }
        .card-image-container { position: relative; width: 100%; padding-top: 133%; background-color: #eee; overflow: hidden; }
        .card-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
        .card:hover .card-img { transform: scale(1.05); }
        .badge { position: absolute; top: 10px; left: 10px; background-color: #ff4757; color: white; padding: 4px 8px; font-size: 0.75rem; font-weight: 700; border-radius: 4px; z-index: 2; }

        /* Botón Wishlist en Tarjeta */
        .card-wishlist-btn {
            position: absolute; top: 10px; right: 10px; z-index: 5;
            background: rgba(255,255,255,0.9); width: 32px; height: 32px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            border: none; cursor: pointer; color: #ccc; font-size: 1rem;
            transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        [data-theme="dark"] .card-wishlist-btn { background: rgba(30,30,30,0.9); color: #aaa; }
        .card-wishlist-btn:hover { transform: scale(1.1); }
        .card-wishlist-btn.active { color: var(--heart-color); }

        .card-actions {
            position: absolute; bottom: -50px; left: 0; width: 100%; display: flex; justify-content: center;
            padding: 10px; background: rgba(255,255,255,0.8); backdrop-filter: blur(4px); transition: bottom 0.3s ease; z-index: 3;
        }
        [data-theme="dark"] .card-actions { background: rgba(0,0,0,0.8); }
        .card:hover .card-actions { bottom: 0; }
        .add-to-cart-btn {
            background-color: var(--primary-color); color: var(--bg-color); border: none; padding: 8px 20px;
            border-radius: 20px; font-weight: 600; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 5px;
        }
        .add-to-cart-btn:hover { background-color: var(--accent-color); }
        .card-info { padding: 1rem; }
        .card-title { font-size: 0.95rem; font-weight: 400; margin-bottom: 0.5rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-price-row { display: flex; align-items: center; gap: 10px; }
        .price { font-weight: 700; }
        .old-price { text-decoration: line-through; color: var(--text-secondary); font-size: 0.85rem; }
        .rating { color: #ffc107; font-size: 0.8rem; margin-top: 5px; }

        /* --- MODAL DE PRODUCTO --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6);
            z-index: 2000; display: none; justify-content: center; align-items: center; padding: 1rem; backdrop-filter: blur(5px);
        }
        .modal-overlay.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content {
            background-color: var(--card-bg); width: 100%; max-width: 1000px; max-height: 90vh; border-radius: 12px;
            position: relative; display: flex; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        .close-modal-btn {
            position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.1); border: none;
            width: 32px; height: 32px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; z-index: 10; color: var(--text-color);
        }
        .close-modal-btn:hover { background: rgba(0,0,0,0.2); }
        .modal-body { display: flex; width: 100%; overflow: hidden; height: 100%; }
        
        /* --- GALERÍA DE IMÁGENES --- */
        .modal-image-col {
            flex: 1.2;
            background-color: #f0f0f0;
            display: flex;
            overflow-y: auto;
            padding: 2rem;
            min-height: 400px;
        }
        [data-theme="dark"] .modal-image-col { background-color: #2a2a2a; }

        .gallery-wrapper { display: flex; width: 100%; height: 100%; gap: 20px; }
        .thumbnail-list {
            display: flex; flex-direction: column; gap: 10px; width: 80px; overflow-y: auto;
        }
        .thumbnail-item {
            width: 100%; aspect-ratio: 1; border-radius: 8px; overflow: hidden; cursor: pointer;
            border: 2px solid transparent; opacity: 0.6; transition: all 0.2s; flex-shrink: 0;
        }
        .thumbnail-item:hover { opacity: 1; }
        .thumbnail-item.active { border-color: var(--primary-color); opacity: 1; }
        .thumbnail-item img { width: 100%; height: 100%; object-fit: cover; }

        .main-image-container {
            flex: 1; display: flex; align-items: center; justify-content: center;
            border-radius: 8px; overflow: hidden; background-color: var(--card-bg);
            position: relative; cursor: zoom-in;
        }
        .modal-img { max-width: 100%; max-height: 100%; object-fit: contain; transition: opacity 0.3s ease; }

        /* Zoom Trigger */
        .zoom-trigger {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.2s ease; pointer-events: none; color: white; font-size: 2.5rem;
        }
        .main-image-container:hover .zoom-trigger { opacity: 1; }

        /* --- MODO ZOOM --- */
        .modal-content.is-zoomed {
            max-width: 100%; max-height: 100%; border-radius: 0; width: 100%; height: 100%;
        }
        .modal-content.is-zoomed .modal-image-col { flex: 1; background-color: black; padding: 0; overflow: hidden; }
        .modal-content.is-zoomed .modal-details-col { display: none; }
        .modal-content.is-zoomed .main-image-container { border-radius: 0; cursor: zoom-out; padding: 20px; }
        .modal-content.is-zoomed .thumbnail-list {
            width: 100px; background-color: rgba(0,0,0,0.6); padding: 10px; backdrop-filter: blur(5px);
        }

        @media (max-width: 768px) {
            .gallery-wrapper { flex-direction: column; }
            .thumbnail-list {
                flex-direction: row; width: 100%; height: auto; order: 2;
            }
            .thumbnail-item { width: 60px; }
            .main-image-container { order: 1; height: 350px; }
        }

        .modal-details-col { flex: 1; padding: 2rem; display: flex; flex-direction: column; gap: 1rem; overflow-y: auto; }
        
        .modal-wishlist-row { display: flex; justify-content: flex-end; }
        .modal-wishlist-btn {
            background: none; border: 1px solid var(--border-color); padding: 8px 15px;
            border-radius: 20px; cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 8px;
            transition: all 0.2s;
        }
        .modal-wishlist-btn:hover { background-color: var(--bg-color); border-color: var(--primary-color); }
        .modal-wishlist-btn.active { border-color: var(--heart-color); color: var(--heart-color); background-color: rgba(255, 71, 87, 0.05); }

        .modal-category { color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; }
        .modal-title { font-size: 1.8rem; font-weight: 700; line-height: 1.2; }
        .modal-price-row { display: flex; align-items: baseline; gap: 15px; margin-top: 5px; }
        .modal-price { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
        .modal-old-price { text-decoration: line-through; color: var(--text-secondary); font-size: 1.1rem; }
        .modal-description { color: var(--text-secondary); line-height: 1.6; font-size: 0.95rem; }
        .variant-section h4 { font-size: 0.9rem; margin-bottom: 8px; color: var(--text-color); }
        .color-options { display: flex; gap: 10px; }
        .color-circle { width: 30px; height: 30px; border-radius: 50%; border: 2px solid transparent; cursor: pointer; position: relative; transition: transform 0.2s; }
        .color-circle.selected { border-color: var(--primary-color); transform: scale(1.1); box-shadow: 0 0 0 2px var(--bg-color); }
        .size-options { display: flex; gap: 8px; flex-wrap: wrap; }
        .size-box { padding: 8px 16px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-color); border-radius: 5px; cursor: pointer; font-weight: 500; transition: all 0.2s; }
        .size-box:hover { border-color: var(--primary-color); }
        .size-box.selected { background-color: var(--primary-color); color: var(--bg-color); border-color: var(--primary-color); }
        .modal-add-btn { background-color: var(--primary-color); color: var(--bg-color); border: none; padding: 15px; font-size: 1rem; font-weight: 700; border-radius: 8px; cursor: pointer; width: 100%; margin-top: auto; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .modal-add-btn:hover { opacity: 0.9; }

        /* --- MODAL CARRITO --- */
        .cart-overlay {
            position: fixed; top: 0; right: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);
            z-index: 2500; display: none; justify-content: flex-end;
        }
        .cart-overlay.active { display: flex; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        .cart-sidebar {
            background-color: var(--card-bg); width: 100%; max-width: 400px; height: 100%;
            display: flex; flex-direction: column; box-shadow: -5px 0 15px rgba(0,0,0,0.2);
        }
        .cart-header { padding: 1.5rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .cart-header h2 { font-size: 1.2rem; color: var(--primary-color); }
        .cart-items { flex: 1; overflow-y: auto; padding: 1.5rem; }
        
        .cart-item { display: flex; gap: 15px; margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); }
        .cart-item-img { width: 70px; height: 90px; object-fit: cover; border-radius: 5px; }
        .cart-item-details { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .cart-item-title { font-size: 0.95rem; font-weight: 600; margin-bottom: 5px; color: var(--text-color); }
        .cart-item-variant { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 5px; }
        .cart-item-price { font-weight: 700; color: var(--primary-color); }
        .cart-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 5px; }
        .qty-selector { display: flex; align-items: center; gap: 10px; background: var(--bg-color); padding: 2px; border-radius: 4px; }
        .qty-btn { width: 25px; height: 25px; border: none; background: transparent; cursor: pointer; color: var(--text-color); font-size: 1rem; display: flex; align-items: center; justify-content: center; }
        .qty-btn:hover { color: var(--accent-color); }
        .qty-val { font-size: 0.9rem; width: 20px; text-align: center; font-weight: 600; }
        .remove-btn { background: none; border: none; color: #ff4757; cursor: pointer; font-size: 0.9rem; }
        .remove-btn:hover { text-decoration: underline; }

        .cart-empty { text-align: center; margin-top: 2rem; color: var(--text-secondary); }
        
        .cart-footer { padding: 1.5rem; border-top: 1px solid var(--border-color); background-color: var(--card-bg); }
        .cart-total-row { display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: 700; margin-bottom: 1rem; color: var(--primary-color); }
        .checkout-btn { width: 100%; padding: 12px; background-color: var(--primary-color); color: var(--bg-color); border: none; border-radius: 5px; font-weight: 600; cursor: pointer; }
        .checkout-btn:hover { background-color: var(--accent-color); }

        /* --- MODAL LISTA DE DESEOS --- */
        .wishlist-sidebar {
            background-color: var(--card-bg); width: 100%; max-width: 900px; height: 90vh;
            display: flex; flex-direction: column; margin: auto; border-radius: 12px; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 95%;
        }
        .wishlist-items { flex: 1; overflow-y: auto; padding: 2rem; display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1.5rem; }
        .wishlist-item-card {
            background-color: var(--bg-color); border-radius: 8px; position: relative; overflow: hidden; border: 1px solid var(--border-color);
        }
        .wishlist-img { width: 100%; padding-top: 100%; position: relative; cursor: pointer; }
        .wishlist-img img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .wishlist-info { padding: 10px; }
        .wishlist-title { font-size: 0.85rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .wishlist-price { font-weight: 700; font-size: 0.9rem; margin-top: 5px; }
        .wishlist-delete {
            position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.6); color: white;
            border: none; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .wishlist-delete:hover { background: var(--heart-color); }

        /* --- Toast --- */
        .toast {
            position: fixed; bottom: 20px; right: 20px; background-color: var(--primary-color); color: var(--bg-color);
            padding: 12px 24px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: flex; align-items: center; gap: 10px; transform: translateY(100px); opacity: 0; transition: all 0.3s ease; z-index: 3000;
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        footer { background-color: var(--card-bg); padding: 3rem 2rem; margin-top: 2rem; border-top: 1px solid var(--border-color); text-align: center; color: var(--text-secondary); }
    </style>
</head>
<body>

    <!-- Encabezado -->
    <header>
        <div class="header-left">
            <!-- Botón Menú Móvil (Hamburguesa) -->
            <button class="hamburger-btn" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo-container" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                <img src="https://z-cdn-media.chatglm.cn/files/8716b5a9-6848-451c-adf4-cd90b8d12c1f.png?auth_key=1869613081-6501802bdd194043b64e07180eca8ae5-0-b629bf343bae74bfbd8665afbff40994" alt="Logo YILI & LIA" class="logo-img">
            </div>
        </div>

        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Buscar ropa, calzado y más...">
        </div>

        <div class="user-actions">
            <button class="icon-btn" id="themeToggle" title="Cambiar Tema"><i class="fas fa-moon"></i></button>
            <!-- Botón Wishlist -->
            <button class="icon-btn" onclick="openWishlist()" title="Lista de Deseos">
                <i class="fas fa-heart"></i>
                <span class="badge" id="wishlistCount">0</span>
            </button>
            <!-- Botón Carrito -->
            <button class="icon-btn" onclick="openCart()" title="Ver Cesta">
                <i class="fas fa-shopping-bag"></i>
                <span class="badge" id="cartCount">0</span>
            </button>
        </div>
    </header>

    <div class="container">
        <!-- Overlay para cerrar menú móvil -->
        <div class="mobile-overlay" id="mobileOverlay" onclick="toggleMobileMenu()"></div>

        <aside id="sidebar">
            <!-- Botón cerrar solo visible en móvil -->
            <button class="mobile-close-btn" onclick="toggleMobileMenu()">&times;</button>
            
            <div class="filter-section">
                <h3 class="filter-title">Categorías</h3>
                <ul class="filter-group" id="categoryFilters">
                    <li class="filter-item active" onclick="filterByCategory('Todos')">Todos los productos</li>
                    <li class="filter-item" onclick="filterByCategory('Mujeres')">Mujeres</li>
                    <li class="filter-item" onclick="filterByCategory('Hombres')">Hombres</li>
                    <li class="filter-item" onclick="filterByCategory('Niños')">Niños</li>
                </ul>
            </div>
            <div class="filter-section">
                <h3 class="filter-title">Tipo</h3>
                <ul class="filter-group" id="typeFilters">
                    <li class="filter-item"><input type="checkbox" class="filter-checkbox" value="Ropa" onchange="applyFilters()"> Ropa</li>
                    <li class="filter-item"><input type="checkbox" class="filter-checkbox" value="Calzado" onchange="applyFilters()"> Calzado</li>
                    <li class="filter-item"><input type="checkbox" class="filter-checkbox" value="Accesorios" onchange="applyFilters()"> Accesorios</li>
                </ul>
            </div>
            <div class="filter-section">
                <h3 class="filter-title">Ofertas</h3>
                <ul class="filter-group">
                    <li class="filter-item"><input type="checkbox" id="saleOnly" class="filter-checkbox" onchange="applyFilters()"> En oferta</li>
                </ul>
            </div>
        </aside>

        <main>
            <div class="product-header">
                <span class="product-count" id="resultCount">Mostrando todos los productos</span>
                <select class="sort-select" onchange="sortProducts(this.value)">
                    <option value="recommended">Recomendado</option>
                    <option value="low-high">Precio: Menor a Mayor</option>
                    <option value="high-low">Precio: Mayor a Menor</option>
                </select>
            </div>

            <div class="grid" id="productGrid"></div>
        </main>
    </div>

    <!-- MODAL DE PRODUCTO -->
    <div id="productModal" class="modal-overlay">
        <div class="modal-content" id="modalContent">
            <button class="close-modal-btn" onclick="closeModal()">&times;</button>
            <div class="modal-body">
                <!-- Columna de Imagen con Galería -->
                <div class="modal-image-col">
                    <div class="gallery-wrapper">
                        <!-- Thumbnails -->
                        <div class="thumbnail-list" id="thumbnailList">
                            <!-- Se generan con JS -->
                        </div>
                        <!-- Imagen Principal -->
                        <div class="main-image-container" id="mainImageContainer">
                            <img src="" alt="Producto" id="modalImg" class="modal-img">
                            <!-- Overlay de Zoom (Lupa con signo más) -->
                            <div class="zoom-trigger">
                                <i class="fas fa-search-plus"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-details-col">
                    <div class="modal-wishlist-row">
                        <button class="modal-wishlist-btn" id="modalWishlistBtn" onclick="toggleModalWishlist()">
                            <i class="far fa-heart"></i> Guardar en lista de deseos
                        </button>
                    </div>
                    <span class="modal-category" id="modalCategory">Categoría</span>
                    <h2 class="modal-title" id="modalTitle">Nombre del Producto</h2>
                    <div class="modal-price-row">
                        <span class="modal-price" id="modalPrice">$0.00</span>
                        <span class="modal-old-price" id="modalOldPrice"></span>
                    </div>
                    <div class="rating" id="modalRating"></div>
                    
                    <p class="modal-description" id="modalDescription">Descripción...</p>

                    <div class="variant-section" id="colorSection">
                        <h4>Color: <span id="selectedColorName" style="font-weight:normal; color: var(--text-secondary);">Selecciona una opción</span></h4>
                        <div class="color-options" id="modalColors"></div>
                    </div>

                    <div class="variant-section">
                        <h4>Talla:</h4>
                        <div class="size-options" id="modalSizes"></div>
                    </div>

                    <button class="modal-add-btn" onclick="addModalToCart()">
                        <i class="fas fa-shopping-cart"></i> Añadir a la bolsa
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL CARRITO -->
    <div id="cartModal" class="cart-overlay">
        <div class="cart-sidebar">
            <div class="cart-header">
                <h2>Tu Cesta</h2>
                <button class="icon-btn" onclick="closeCart()"><i class="fas fa-times"></i></button>
            </div>
            <div class="cart-items" id="cartItemsContainer">
                <!-- Items se renderizan aquí -->
            </div>
            <div class="cart-footer">
                <div class="cart-total-row">
                    <span>Total</span>
                    <span id="cartTotal">$0.00</span>
                </div>
                <button class="checkout-btn" onclick="alert('¡Gracias por tu compra! Esta es una demo.')">Ir a Pagar</button>
            </div>
        </div>
    </div>

    <!-- MODAL LISTA DE DESEOS -->
    <div id="wishlistModal" class="modal-overlay">
        <div class="wishlist-sidebar">
            <div class="cart-header" style="background: var(--bg-color);">
                <h2><i class="fas fa-heart" style="color: var(--heart-color);"></i> Mi Lista de Deseos</h2>
                <button class="icon-btn" onclick="closeWishlist()"><i class="fas fa-times"></i></button>
            </div>
            <div class="wishlist-items" id="wishlistItemsContainer">
                <!-- Wishlist items here -->
            </div>
        </div>
    </div>

    <footer>
        <div class="brand-name" style="margin-bottom: 1rem; color: var(--text-color);">YILI & LIA</div>
        <p>&copy; 2023 YILI & LIA. Todos los derechos reservados.</p>
    </footer>

    <div id="toast" class="toast"><i class="fas fa-check-circle"></i><span id="toastMessage">Mensaje</span></div>

    <script>
        // --- 1. Base de Datos ---
        const productDatabase = [
            {
                id: 1,
                name: "Vestido de noche elegante de seda",
                category: "Mujeres",
                type: "Ropa",
                price: 89.99,
                original_price: 120.00,
                rating: 4.8,
                images: [
                    "https://images.unsplash.com/photo-1595777457583-95e059d581b8?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1566174053879-31528523f8ae?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?auto=format&fit=crop&w=1200&q=60"
                ],
                description: "Eleva tu estilo nocturno con este vestido de seda fluida. Diseño de corte imperial con cuello en V y detalles de encaje en los hombros.",
                sizes: ["S", "M", "L", "XL"],
                colors: [{name: "Negro", code: "#1a1a1a"}, {name: "Rojo", code: "#800000"}]
            },
            {
                id: 2,
                name: "Chaqueta Denim Clásica",
                category: "Hombres",
                type: "Ropa",
                price: 55.00,
                original_price: null,
                rating: 4.5,
                images: [
                    "https://images.unsplash.com/photo-1551028719-00167b16eac5?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1521223890158-f9f7c3d5d504?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1529139574466-a302d27925ee?auto=format&fit=crop&w=1200&q=60"
                ],
                description: "Una prenda esencial para el armario masculino. Hecho de mezclilla resistente pero cómoda. Cuenta con cuatro bolsillos funcionales.",
                sizes: ["M", "L", "XL", "XXL"],
                colors: [{name: "Azul Claro", code: "#87CEEB"}, {name: "Negro", code: "#000000"}]
            },
            {
                id: 3,
                name: "Vestido Floral de Verano",
                category: "Mujeres",
                type: "Ropa",
                price: 35.50,
                original_price: 45.00,
                rating: 4.2,
                images: [
                    "https://images.unsplash.com/photo-1572804013309-59a88b7e92f1?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1572804013309-59a88b7e92f1?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1496747611176-843222e1e57c?auto=format&fit=crop&w=1200&q=60"
                ],
                description: "Fresco y ligero, ideal para los días de calor. Impresión floral vibrante sobre tela de algodón transpirable.",
                sizes: ["S", "M", "L"],
                colors: [{name: "Multicolor", code: "linear-gradient(45deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%)"}, {name: "Rosa Pastel", code: "#FFC0CB"}]
            },
            {
                id: 4,
                name: "Zapatillas Coloridas para Niños",
                category: "Niños",
                type: "Calzado",
                price: 29.99,
                original_price: null,
                rating: 4.7,
                images: [
                    "https://images.unsplash.com/photo-1555274175-75f79b09d5b8?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1551107696-a4b0c5a0d9a2?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1552346154-21d32810aba3?auto=format&fit=crop&w=1200&q=60"
                ],
                description: "Diseñadas para la diversión infinita. Suela antideslizante resistente y cierre de velcro fácil de poner.",
                sizes: ["28", "30", "32", "34"],
                colors: [{name: "Neón", code: "#39FF14"}, {name: "Azul/Rojo", code: "#FF4500"}]
            },
            {
                id: 5,
                name: "Camiseta de Algodón Casual",
                category: "Hombres",
                type: "Ropa",
                price: 15.99,
                original_price: 25.00,
                rating: 4.0,
                images: [
                    "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1583743814966-8936f5b7be1a?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1581655353564-df123a1eb820?auto=format&fit=crop&w=1200&q=60"
                ],
                description: "Básico indispensable. 100% algodón de alta calidad que no se encoge. Ajuste moderno.",
                sizes: ["S", "M", "L", "XL", "XXL"],
                colors: [{name: "Blanco", code: "#ffffff"}, {name: "Gris", code: "#808080"}, {name: "Negro", code: "#000000"}]
            },
            {
                id: 6,
                name: "Collar Dorado Plateado",
                category: "Mujeres",
                type: "Accesorios",
                price: 42.00,
                original_price: null,
                rating: 4.9,
                images: [
                    "https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1601121141461-9d6647bca1ed?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1611591437281-460bfbe1220a?auto=format&fit=crop&w=1200&q=60"
                ],
                description: "Añade un toque de elegancia con este collar chapado en oro 18k. Diseño minimalista con un colgante delicado.",
                sizes: ["Única"],
                colors: [{name: "Oro", code: "#FFD700"}, {name: "Plata", code: "#C0C0C0"}]
            },
            {
                id: 7,
                name: "Zapatillas Deportivas para Correr",
                category: "Hombres",
                type: "Calzado",
                price: 75.00,
                original_price: 99.99,
                rating: 4.6,
                images: [
                    "https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1543508282-6319a3e2621f?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1606107557195-0e29a4b5b4aa?auto=format&fit=crop&w=1200&q=60"
                ],
                description: "Tecnología de amortiguación avanzada para correr largas distancias. Malla transpirable.",
                sizes: ["40", "41", "42", "43", "44"],
                colors: [{name: "Rojo/Negro", code: "#000000"}, {name: "Azul/Blanco", code: "#FFFFFF"}]
            },
            {
                id: 8,
                name: "Vestido de Fiesta para Niñas",
                category: "Niños",
                type: "Ropa",
                price: 32.50,
                original_price: null,
                rating: 4.8,
                images: [
                    "https://images.unsplash.com/photo-1518831959646-742c3a14ebf7?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1543817656-5cf3399aff75?auto=format&fit=crop&w=1200&q=60"
                ],
                description: "Encanto y elegancia para la pequeña de la casa. Tela de tul suave con aplicaciones de flores.",
                sizes: ["4-5 Años", "6-7 Años", "8-9 Años"],
                colors: [{name: "Rosa", code: "#FFB6C1"}, {name: "Morado", code: "#800080"}]
            },
            {
                id: 9,
                name: "Bolso de Cuero",
                category: "Mujeres",
                type: "Accesorios",
                price: 110.00,
                original_price: 140.00,
                rating: 4.7,
                images: [
                    "https://images.unsplash.com/photo-1584917865442-de89df76afd3?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1590874103328-3732c9618c3d?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1566150905458-1bf1fc113f0d?auto=format&fit=crop&w=1200&q=60"
                ],
                description: "Bolso tipo tote espacioso y duradero. Cuero vegano de alta calidad con costuras reforzadas.",
                sizes: ["Única"],
                colors: [{name: "Café", code: "#964B00"}, {name: "Negro", code: "#000000"}]
            },
            {
                id: 10,
                name: "Pantalón Corto Denim Niño",
                category: "Niños",
                type: "Ropa",
                price: 20.00,
                original_price: null,
                rating: 4.3,
                images: [
                    "https://images.unsplash.com/photo-1503944168839-9184912c1eb3?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1543269865-cbf427effbad?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&w=1200&q=60"
                ],
                description: "Comodidad y resistencia para jugar todo el día. Tiro medio y elástico en la cintura.",
                sizes: ["8 Años", "10 Años", "12 Años"],
                colors: [{name: "Azul", code: "#0000FF"}]
            },
            {
                id: 11,
                name: "Suéter de Punto de Invierno",
                category: "Mujeres",
                type: "Ropa",
                price: 45.00,
                original_price: 60.00,
                rating: 4.5,
                images: [
                    "https://images.unsplash.com/photo-1576566588028-4147f3842f27?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1620799140408-ed5341cd2431?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1574483285065-bd8e9b7854d1?auto=format&fit=crop&w=1200&q=60"
                ],
                description: "Cálida abrigo para los días fríos. Tejido de punto grueso con cuello alto.",
                sizes: ["S", "M", "L"],
                colors: [{name: "Crema", code: "#FFFDD0"}, {name: "Beige", code: "#F5F5DC"}]
            },
            {
                id: 12,
                name: "Zapatos Formales de Cuero",
                category: "Hombres",
                type: "Calzado",
                price: 95.00,
                original_price: null,
                rating: 4.8,
                images: [
                    "https://images.unsplash.com/photo-1614252235316-8c857d38b5f4?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1617606002807-b8463ca6fdeb?auto=format&fit=crop&w=1200&q=60",
                    "https://images.unsplash.com/photo-1614252369475-531eba835eb1?auto=format&fit=crop&w=1200&q=60"
                ],
                description: "Para la oficina o eventos formales. Cuero pulido con clásicos cordones.",
                sizes: ["40", "41", "42", "43", "44", "45"],
                colors: [{name: "Negro", code: "#000000"}, {name: "Café", code: "#8B4513"}]
            }
        ];

        // --- 2. Estado Global (Con Persistencia LocalStorage) ---
        let currentData = [...productDatabase];
        let currentCategory = 'Todos';
        let wishlist = JSON.parse(localStorage.getItem('yili_wishlist')) || [];
        let cart = JSON.parse(localStorage.getItem('yili_cart')) || [];
        let activeModalProduct = null;
        let selectedSize = null;
        let selectedColor = null;

        // --- 3. Renderizado Grid ---
        const grid = document.getElementById('productGrid');
        const countLabel = document.getElementById('resultCount');

        function renderProducts(products) {
            grid.innerHTML = '';
            if (products.length === 0) {
                grid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-secondary);">No se encontraron productos.</div>`;
                countLabel.textContent = `0 Resultados`;
                return;
            }
            countLabel.textContent = `${products.length} Resultado${products.length !== 1 ? 's' : ''}`;

            products.forEach(product => {
                const discount = product.original_price ? Math.round(((product.original_price - product.price) / product.original_price) * 100) : 0;
                const isWishlisted = wishlist.some(w => w.id === product.id);
                const mainImage = product.images ? product.images[0] : '';

                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = () => openModal(product.id);
                
                card.innerHTML = `
                    <div class="card-image-container">
                        ${discount > 0 ? `<span class="badge">-${discount}%</span>` : ''}
                        <button class="card-wishlist-btn ${isWishlisted ? 'active' : ''}" onclick="event.stopPropagation(); toggleWishlist(${product.id})">
                            <i class="${isWishlisted ? 'fas' : 'far'} fa-heart"></i>
                        </button>
                        <img src="${mainImage}" alt="${product.name}" class="card-img">
                        <div class="card-actions">
                            <button class="add-to-cart-btn">
                                <i class="fas fa-eye"></i> Ver
                            </button>
                        </div>
                    </div>
                    <div class="card-info">
                        <h3 class="card-title">${product.name}</h3>
                        <div class="card-price-row">
                            <span class="price">$${product.price.toFixed(2)}</span>
                            ${product.original_price ? `<span class="old-price">$${product.original_price.toFixed(2)}</span>` : ''}
                        </div>
                        <div class="rating">${getStarRating(product.rating)} (${product.rating})</div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function getStarRating(rating) {
            let stars = '';
            for(let i=0; i<5; i++) {
                if(i < Math.floor(rating)) stars += '<i class="fas fa-star"></i>';
                else if(i < rating) stars += '<i class="fas fa-star-half-alt"></i>';
                else stars += '<i class="far fa-star"></i>';
            }
            return stars;
        }

        // --- 4. Lógica de Wishlist con Persistencia ---
        function toggleWishlist(productId) {
            const product = productDatabase.find(p => p.id === productId);
            if(!product) return;
            const index = wishlist.findIndex(w => w.id === productId);
            if(index === -1) {
                wishlist.push(product);
                showToast("Añadido a lista de deseos");
            } else {
                wishlist.splice(index, 1);
                showToast("Eliminado de lista de deseos");
            }
            localStorage.setItem('yili_wishlist', JSON.stringify(wishlist));
            updateWishlistUI();
        }

        function updateWishlistUI() {
            document.getElementById('wishlistCount').textContent = wishlist.length;
            if(activeModalProduct) {
                const btn = document.getElementById('modalWishlistBtn');
                const isWishlisted = wishlist.some(w => w.id === activeModalProduct.id);
                if(isWishlisted) {
                    btn.classList.add('active');
                    btn.innerHTML = '<i class="fas fa-heart"></i> Guardado';
                } else {
                    btn.classList.remove('active');
                    btn.innerHTML = '<i class="far fa-heart"></i> Guardar en lista de deseos';
                }
            }
            if(document.getElementById('wishlistModal').classList.contains('active')) renderWishlistModal();
            renderProducts(currentData);
        }

        function renderWishlistModal() {
            const container = document.getElementById('wishlistItemsContainer');
            container.innerHTML = '';
            if(wishlist.length === 0) {
                container.innerHTML = `<div class="cart-empty" style="grid-column: 1/-1;"><i class="far fa-heart" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i><p>Tu lista de deseos está vacía.</p></div>`;
                return;
            }
            wishlist.forEach(item => {
                const el = document.createElement('div');
                el.className = 'wishlist-item-card';
                const thumb = item.images ? item.images[0] : '';
                el.innerHTML = `
                    <div class="wishlist-img" onclick="openModal(${item.id}); closeWishlist();">
                        <img src="${thumb}" alt="${item.name}">
                        <button class="wishlist-delete" onclick="event.stopPropagation(); toggleWishlist(${item.id})"><i class="fas fa-trash-alt"></i></button>
                    </div>
                    <div class="wishlist-info">
                        <div class="wishlist-title">${item.name}</div>
                        <div class="wishlist-price">$${item.price.toFixed(2)}</div>
                    </div>
                `;
                container.appendChild(el);
            });
        }

        function openWishlist() {
            document.getElementById('wishlistModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            renderWishlistModal();
        }

        function closeWishlist() {
            document.getElementById('wishlistModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // --- 5. Filtros y Búsqueda ---
        function filterByCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.filter-item').forEach(el => el.classList.remove('active'));
            const desktopItems = document.querySelectorAll('#categoryFilters .filter-item');
            desktopItems.forEach(item => { if(item.textContent.includes(category)) item.classList.add('active'); });
            applyFilters();
        }

        function applyFilters() {
            const typeCheckboxes = document.querySelectorAll('#typeFilters .filter-checkbox:checked');
            const selectedTypes = Array.from(typeCheckboxes).map(cb => cb.value);
            const saleOnly = document.getElementById('saleOnly').checked;

            currentData = productDatabase.filter(product => {
                const matchCategory = currentCategory === 'Todos' || product.category === currentCategory;
                const matchType = selectedTypes.length === 0 || selectedTypes.includes(product.type);
                const matchSale = !saleOnly || (saleOnly && product.original_price !== null);
                return matchCategory && matchType && matchSale;
            });
            renderProducts(currentData);
            
            // Si estamos en móvil, cerrar el menú después de filtrar para ver resultados
            if(window.innerWidth < 900) {
                toggleMobileMenu(false); // false fuerza a cerrar
            }
        }

        function sortProducts(criteria) {
            let sorted = [...currentData];
            if (criteria === 'low-high') sorted.sort((a, b) => a.price - b.price);
            else if (criteria === 'high-low') sorted.sort((a, b) => b.price - a.price);
            else sorted.sort((a, b) => a.id - b.id);
            renderProducts(sorted);
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = productDatabase.filter(p => p.name.toLowerCase().includes(term) || p.category.toLowerCase().includes(term) || p.type.toLowerCase().includes(term));
            renderProducts(filtered);
        });

        // --- 6. LÓGICA DEL MENÚ MÓVIL (Estilo Amazon) ---
        function toggleMobileMenu(forceState) {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            const isOpen = forceState !== undefined ? forceState : !sidebar.classList.contains('open');

            if (isOpen) {
                sidebar.classList.add('open');
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden'; // Evitar scroll de fondo
            } else {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
                document.body.style.overflow = 'auto'; // Restaurar scroll
            }
        }

        // --- 7. LÓGICA DEL MODAL PRODUCTO CON ZOOM ---
        const modal = document.getElementById('productModal');

        function openModal(productId) {
            const product = productDatabase.find(p => p.id === productId);
            if(!product) return;
            activeModalProduct = product;
            selectedSize = null;
            selectedColor = null;

            // Reset Zoom state
            document.getElementById('modalContent').classList.remove('is-zoomed');

            // Datos básicos
            document.getElementById('modalCategory').textContent = product.category + ' - ' + product.type;
            document.getElementById('modalTitle').textContent = product.name;
            document.getElementById('modalPrice').textContent = '$' + product.price.toFixed(2);
            document.getElementById('modalDescription').textContent = product.description;
            document.getElementById('modalRating').innerHTML = getStarRating(product.rating) + ` (${product.rating})`;
            
            const oldPriceEl = document.getElementById('modalOldPrice');
            if(product.original_price) {
                oldPriceEl.textContent = '$' + product.original_price.toFixed(2);
                oldPriceEl.style.display = 'inline-block';
            } else { oldPriceEl.style.display = 'none'; }

            // GALERÍA DE IMÁGENES
            const thumbnailList = document.getElementById('thumbnailList');
            thumbnailList.innerHTML = '';
            
            if(product.images && product.images.length > 0) {
                changeMainImage(product.images[0]);
                product.images.forEach((imgUrl, index) => {
                    const thumb = document.createElement('div');
                    thumb.className = `thumbnail-item ${index === 0 ? 'active' : ''}`;
                    thumb.innerHTML = `<img src="${imgUrl}" alt="Vista ${index+1}">`;
                    thumb.onclick = () => {
                        document.querySelectorAll('.thumbnail-item').forEach(t => t.classList.remove('active'));
                        thumb.classList.add('active');
                        changeMainImage(imgUrl);
                    };
                    thumbnailList.appendChild(thumb);
                });
            } else {
                changeMainImage('https://via.placeholder.com/500');
            }

            // Colores
            const colorContainer = document.getElementById('modalColors');
            const colorNameSpan = document.getElementById('selectedColorName');
            colorContainer.innerHTML = '';
            colorNameSpan.textContent = 'Selecciona una opción';
            product.colors.forEach((color) => {
                const circle = document.createElement('div');
                circle.className = 'color-circle';
                circle.style.backgroundColor = color.code;
                circle.title = color.name;
                circle.onclick = () => {
                    document.querySelectorAll('.color-circle').forEach(c => c.classList.remove('selected'));
                    circle.classList.add('selected');
                    selectedColor = color.name;
                    colorNameSpan.textContent = color.name;
                };
                colorContainer.appendChild(circle);
            });

            // Tallas
            const sizeContainer = document.getElementById('modalSizes');
            sizeContainer.innerHTML = '';
            product.sizes.forEach(size => {
                const box = document.createElement('div');
                box.className = 'size-box';
                box.textContent = size;
                box.onclick = () => {
                    document.querySelectorAll('.size-box').forEach(b => b.classList.remove('selected'));
                    box.classList.add('selected');
                    selectedSize = size;
                };
                sizeContainer.appendChild(box);
            });

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            updateWishlistUI(); 
        }

        function changeMainImage(url) {
            const imgEl = document.getElementById('modalImg');
            imgEl.style.opacity = '0.5';
            setTimeout(() => {
                imgEl.src = url;
                imgEl.onload = () => { imgEl.style.opacity = '1'; };
            }, 150);
        }

        function closeModal() {
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            activeModalProduct = null;
            document.getElementById('modalContent').classList.remove('is-zoomed');
        }
        
        function toggleModalWishlist() {
            if(activeModalProduct) {
                toggleWishlist(activeModalProduct.id);
            }
        }

        modal.addEventListener('click', (e) => { if(e.target === modal) closeModal(); });

        // --- 8. LÓGICA DEL CARRITO con Persistencia ---
        const cartModal = document.getElementById('cartModal');
        const cartItemsContainer = document.getElementById('cartItemsContainer');
        const cartTotalEl = document.getElementById('cartTotal');
        const cartCountEl = document.getElementById('cartCount');

        function addModalToCart() {
            if(!activeModalProduct) return;
            if(activeModalProduct.colors.length > 0 && !selectedColor) {
                alert("Por favor selecciona un color."); return;
            }
            if(!selectedSize) {
                alert("Por favor selecciona una talla."); return;
            }

            const cartKey = activeModalProduct.id + '-' + selectedSize + '-' + selectedColor;
            const existingItem = cart.find(item => item.cartKey === cartKey);

            if(existingItem) {
                existingItem.qty++;
            } else {
                const mainImg = activeModalProduct.images ? activeModalProduct.images[0] : '';
                cart.push({
                    cartKey: cartKey,
                    id: activeModalProduct.id,
                    name: activeModalProduct.name,
                    price: activeModalProduct.price,
                    size: selectedSize,
                    color: selectedColor,
                    image: mainImg,
                    qty:1
                });
            }
            localStorage.setItem('yili_cart', JSON.stringify(cart));
            updateCartUI();
            showToast("Producto añadido a la cesta");
            closeModal();
        }

        function updateCartUI() {
            const totalQty = cart.reduce((sum, item) => sum + item.qty, 0);
            cartCountEl.textContent = totalQty;
            cartItemsContainer.innerHTML = '';
            let totalAmount = 0;

            if(cart.length === 0) {
                cartItemsContainer.innerHTML = `<div class="cart-empty"><i class="fas fa-shopping-basket" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i><p>Tu cesta está vacía.</p></div>`;
            } else {
                cart.forEach(item => {
                    totalAmount += item.price * item.qty;
                    const itemEl = document.createElement('div');
                    itemEl.className = 'cart-item';
                    itemEl.innerHTML = `
                        <img src="${item.image}" class="cart-item-img" alt="${item.name}">
                        <div class="cart-item-details">
                            <div class="cart-item-title">${item.name}</div>
                            <div class="cart-item-variant">Talla: ${item.size} | Color: ${item.color}</div>
                            <div class="cart-item-price">$${item.price.toFixed(2)}</div>
                            <div class="cart-controls">
                                <div class="qty-selector">
                                    <button class="qty-btn" onclick="changeQty('${item.cartKey}', -1)">-</button>
                                    <span class="qty-val">${item.qty}</span>
                                    <button class="qty-btn" onclick="changeQty('${item.cartKey}', 1)">+</button>
                                </div>
                                <button class="remove-btn" onclick="removeFromCart('${item.cartKey}')">Eliminar</button>
                            </div>
                        </div>
                    `;
                    cartItemsContainer.appendChild(itemEl);
                });
            }
            cartTotalEl.textContent = '$' + totalAmount.toFixed(2);
        }

        function changeQty(cartKey, delta) {
            const item = cart.find(i => i.cartKey === cartKey);
            if(item) {
                item.qty += delta;
                if(item.qty <= 0) {
                    removeFromCart(cartKey);
                } else {
                    localStorage.setItem('yili_cart', JSON.stringify(cart));
                    updateCartUI();
                }
            }
        }

        function removeFromCart(cartKey) {
            cart = cart.filter(item => item.cartKey !== cartKey);
            localStorage.setItem('yili_cart', JSON.stringify(cart));
            updateCartUI();
        }

        function openCart() {
            cartModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCart() {
            cartModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // --- 9. Lógica de Zoom (Lupa) ---
        const mainImageContainer = document.getElementById('mainImageContainer');
        mainImageContainer.addEventListener('click', (e) => {
            document.getElementById('modalContent').classList.toggle('is-zoomed');
        });

        // --- 10. UI General ---
        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        const themeBtn = document.getElementById('themeToggle');
        const icon = themeBtn.querySelector('i');
        if(localStorage.getItem('theme') === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            icon.classList.replace('fa-moon', 'fa-sun');
        }
        themeBtn.addEventListener('click', () => {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            if(isDark) {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
                icon.classList.replace('fa-sun', 'fa-moon');
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                icon.classList.replace('fa-moon', 'fa-sun');
            }
        });

        // Inicializar
        renderProducts(productDatabase);
    </script>
</body>
</html>
